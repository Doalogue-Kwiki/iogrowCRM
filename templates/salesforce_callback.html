<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="https://storage.googleapis.com/iogrowgs/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsforce/1.4.1/jsforce.min.js"></script>
<script>
    jsforce.browser.init({
  clientId: '3MVG9QDx8IX8nP5SiRx6WcZGt_urvZZKtoKdTRn0h_ITamehH.ndEUTVBGZhyKJKnWdxun.jnZj0dbzCJNydO',
  redirectUri: 'http://localhost:8090/sfoauth2callback',
  proxyUrl:'http://localhost/salesforce_proxy/proxy.php'
});
    </script>
</head>
<body>
  <script>
      var match = window.location.href.match(/code=([^&]+)/) ; 
      console.log(match);
      $.ajax({
            type: 'GET',
            url: '/sfconnect',
            datatype:'json',

            success: function(result) {
              console.log('i am in connectServer show me result please');
              console.log(result);
              // var oauthResult = {};
              // oauthResult.everything = window.location.hash;
              // oauthResult.access_token=decodeURIComponent(access_token[1]);
              // oauthResult.instance_url=decodeURIComponent(url[1]);

              parentWindow.sessionCallback(result);
              // window.close();
            },
            error:function(result){
                var response = result.responseText;
                var rr= response.replace(/'/g,"\"");
                console.log('yyyyy');
                console.log(JSON.parse(rr));
                var oauthResult = JSON.parse(rr);
                var parentWindow = window.opener.parent ;
                parentWindow.sessionCallback(oauthResult);
                window.close();
            },
            data: {code:decodeURIComponent(match[1])}
        });
    
    // try to match an access token in window.location.hash
    // var match = (window.location.hash) ? window.location.hash.match(/#access_token=([^&]+)/) : false;
    // console.log(' oh yeah yeah ');
    // console.log(window.location.hash);
    // // if we found an access token in the URL pass the token up to a global function in
    // var parentWindow = window.opener.parent ;
    // var access_token = window.location.hash.match(/#access_token=([^&]+)/) ;
    // var url = window.location.hash.match(/&instance_url=([^&]+)/) ;
    // var oauthResult = {};
    oauthResult.everything = window.location.hash;
    oauthResult.access_token=decodeURIComponent(access_token[1]);
    oauthResult.instance_url=decodeURIComponent(url[1]);
    parentWindow.sessionCallback(oauthResult);
    window.close();

    

    
    //00D24000000Z3vv%21ASAAQEs2MxlypfPOYN4K7uysasq6jkP7NbFjKKszFt9L4ce0uem1hl_dIZ3jm9SNi4T1lUBtihGOs3B6CrxkKdvyUOJreckT
    //00D24000000Z3vv%21ASAAQEs2MxlypfPOYN4K7uysasq6jkP7NbFjKKszFt9L4ce0uem1hl_dIZ3jm9SNi4T1lUBtihGOs3B6CrxkKdvyUOJreckT


  </script>
</body>
</html>